<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>fzf404 - CTF</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=0.6" />
    <link rel="stylesheet" href="https://cdn.fzf404.art/sedom/dist/sedom.css" />
    <script src="https://cdn.fzf404.art/sedom/dist/sedom.js"></script>
    <script>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?35a26dead5e790cb29ec1d40fdde8f14";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </head>

  <body>
    <h2>å¤ºæ——èµ› ğŸ‰</h2>
    <h4>QinLi Studio 2022 CTF ğŸ</h4>
    <code>
      <pre>docker run -itd -h qlstudio -p 30022:22 fzf404/ctf bash</pre>
      <pre>ssh ql@localhost -p 30022</pre>
      <pre>password: qlstudio</pre>
    </code>
    <hr />
    <p>
      <button id="flag" class="red" disabled>01-flag</button>
      <button id="hide" class="orange" disabled>02-hide</button>
      <button id="find" class="yellow" disabled>03-find</button>
      <button id="unzip" class="green" disabled>04-unzip</button>
    </p>
    <p>
      <button id="access" class="cyan" disabled>05-access</button>
      <button id="python" class="indigo" disabled>06-python</button>
      <button id="nginx" class="purple" disabled>07-nginx</button>
    </p>
    <hr />
    <form>
      <label for="mark">æ ‡è®°</label>
      <input id="mark" type="text" placeholder="è¯·è¾“å…¥æ ‡è®°" />
      <button id="submit" class="blue">æäº¤</button>
    </form>
    <h6 class="space">
      <a class="right blue" href="..">è¿”å›</a>
      <a id="reset" class="right pink">æ¸…ç©º</a>
    </h6>
    <button class="theme">ğŸŒ“</button>
    <script>
      // æˆç»©
      let score = 0;
      // è¾“å…¥æ¡†
      const input = document.getElementById("mark");

      // éªŒè¯æ ‡è®°
      function verify(flag) {
        fetch("flag/" + flag)
          .then((res) => res.json())
          .then((data) => {
            // éªŒè¯æˆåŠŸ
            score += 1;
            // ä¿å­˜ç­”æ¡ˆ
            localStorage.setItem(data, flag);
            // è°ƒæ•´åŠ¨ç”»
            document.getElementById(data).setAttribute("class", "rainbow");
            document.getElementById(data).removeAttribute("disabled");
            // å®Œæˆå…¨éƒ¨
            if (score === 7) {
              // é—ªçƒåŠ¨ç”»
              const flash = setInterval(() => {
                Sedom.toggleTheme();
              }, 300);
              // åœæ­¢é—ªçƒ
              setTimeout(() => {
                clearInterval(flash);
              }, 2000);
            }
          })
          .catch(() => {
            // ä¿®æ”¹æç¤º
            input.setAttribute("placeholder", "æ ‡è®°é”™è¯¯");
          });
      }

      // é‡ç½®æ ‡è®°
      function reset() {
        // æ¸…ç©ºæ ‡è®°
        localStorage.clear();
        // é‡è½½é¡µé¢
        location.reload();
      }

      // åˆå§‹åŒ–é¡µé¢
      function init() {
        // éªŒè¯å·²ä¿å­˜æ ‡è®°
        localStorage.hasOwnProperty("flag") &&
          verify(localStorage.getItem("flag"));
        localStorage.hasOwnProperty("hide") &&
          verify(localStorage.getItem("hide"));
        localStorage.hasOwnProperty("find") &&
          verify(localStorage.getItem("find"));
        localStorage.hasOwnProperty("unzip") &&
          verify(localStorage.getItem("unzip"));
        localStorage.hasOwnProperty("access") &&
          verify(localStorage.getItem("access"));
        localStorage.hasOwnProperty("python") &&
          verify(localStorage.getItem("python"));
        localStorage.hasOwnProperty("nginx") &&
          verify(localStorage.getItem("nginx"));

        // æäº¤äº‹ä»¶å¤„ç†
        document.getElementById("submit").addEventListener("click", (event) => {
          // é˜»æ­¢é»˜è®¤äº‹ä»¶
          event.preventDefault();

          // è·å–æ ‡è®°
          const flag = input.value;

          // æ¸…ç©ºæ ‡è®°
          input.value = "";
          // ä¿®æ”¹æç¤º
          input.setAttribute("placeholder", "è¯·è¾“å…¥æ ‡è®°");

          // éªŒè¯æ ‡è®°é•¿åº¦
          if (flag.length === 8) {
            // éªŒè¯æ ‡è®°å†…å®¹
            verify(flag);
          } else {
            // ä¿®æ”¹æç¤º
            input.setAttribute("placeholder", "æ ‡è®°åº”ä¸º8ä½");
          }
        });

        // æ¸…ç©ºæ ‡è®°
        document.getElementById("reset").addEventListener("click", reset);
      }

      // åˆå§‹åŒ–
      init();
    </script>
  </body>
</html>
